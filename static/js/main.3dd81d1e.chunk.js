(this["webpackJsonpworth-watching"]=this["webpackJsonpworth-watching"]||[]).push([[0],{131:function(e,t,a){e.exports=a(251)},136:function(e,t,a){},251:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(83),c=a.n(r),l=(a(136),a(84)),o=a.n(l);class i{constructor(){this.cache={},this.populateCache()}populateCache(){const e=localStorage.getItem("shows");if(null!==e)try{const t=JSON.parse(e),a=new Date;a.setDate(a.getDate()-5);this.cache=o()(t,e=>!1)}catch(t){console.error("error parsing cached shows",t)}}has(e){return e in this.cache}get(e){return this.cache[e]}set(e,t){this.cache[e.imdbID]={added:(new Date).getTime(),info:e,seasons:t},localStorage.setItem("shows",JSON.stringify(this.cache))}}var u=a(50),d=a.n(u),h=a(85),p=a.n(h);const m=d.a.create({baseURL:"https://www.omdbapi.com/"});m.interceptors.request.use(e=>(e.params.apikey="ddf710b6",e));const f=d.a.create({baseURL:"https://imdb.beuke.org/"}),g=async e=>{try{const{data:t}=await f((e=>`series.json?sql=select+tconst,+parentTconst,+seasonNumber,+episodeNumber,+seriesTitle,+episodeTitle,+rating,+votes+from+series+where+"parentTconst"+=+"${e}"+order+by+CAST(seasonNumber+as+INT),+CAST(episodeNumber+as+INT)`)(e));return function(e,t){const a=t.map(t=>{const a={};return t.forEach((t,n)=>{const s=e[n];a[E[s]||s]=t}),a});a.forEach(e=>{e.season=parseInt(e.season,10),e.episode=parseInt(e.episode,10)});const n=p()(a,"season");return Object.keys(n).map(e=>{var t;const a=n[e];return{seriesTitle:(null===(t=a[0])||void 0===t?void 0:t.seriesTitle)||"",season:parseInt(e),episodes:a}})}(t.columns,t.rows)}catch(t){console.error("error fetching episodes",t)}return null},E={tconst:"seriesID",parentTconst:"episodeID",seasonNumber:"season",episodeNumber:"episode",seriesTitle:"seriesTitle",episodeTitle:"episodeTitle",rating:"rating",votes:"votes"};const y=Object(n.createContext)({selectShow:()=>{},selectedShow:null,isLoading:!1});function b({children:e}){const t=Object(n.useMemo)(()=>new i,[]),[a,r]=Object(n.useState)(null),[c,l]=Object(n.useState)(!1),o=Object(n.useCallback)(async e=>{if(l(!0),!t.has(e)){const n=await(async e=>{try{const{data:t}=await m.get("",{params:{i:e}});return t.totalSeasons=parseInt(t.totalSeasons,10),t}catch(t){console.log("error fetching show",t)}return null})(e);if(null==n)return a("failed to fetch show");const s=await g(e);if(null==s)return a("failed to fetch seasons");t.set(n,s)}function a(e){e&&alert(e),l(!1)}window.history.replaceState("","","?id="+e),r(t.get(e)),a()},[t]);Object(n.useEffect)(()=>{const e=new URLSearchParams(window.location.search);e.has("id")&&o(e.get("id"))},[o]);const u={selectShow:o,selectedShow:a,isLoading:c};return s.a.createElement(y.Provider,{value:u},e)}function w(){return Object(n.useContext)(y)}const v=e=>"n/a"!==e.toLowerCase();function _({results:e,highlighted:t,select:a}){const r=Object(n.useRef)(null);return Object(n.useEffect)(()=>{var e;null===(e=r.current)||void 0===e||e.scrollIntoView(!1)},[t]),e?e.length?s.a.createElement("ul",{className:"search-results"},e.map((e,n)=>s.a.createElement("li",{className:"search-result "+(n===t?"higlighted":""),key:e.imdbID,onClick:()=>a(n),ref:n===t?r:null},s.a.createElement("div",{className:"search-result__poster"},v(e.Poster)?s.a.createElement("img",{src:e.Poster,alt:"poster"}):null),s.a.createElement("span",null,e.Title," ",s.a.createElement("span",{className:"search-result__year"},"(",e.Year,")"))))):s.a.createElement("div",{className:"search-results search-results__empty"},"no results found"):null}function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var N=s.a.createElement("title",null,"magnifying-glass"),O=s.a.createElement("path",{d:"M17.545 15.467l-3.779-3.779c0.57-0.935 0.898-2.035 0.898-3.21 0-3.417-2.961-6.377-6.378-6.377s-6.186 2.769-6.186 6.186c0 3.416 2.961 6.377 6.377 6.377 1.137 0 2.2-0.309 3.115-0.844l3.799 3.801c0.372 0.371 0.975 0.371 1.346 0l0.943-0.943c0.371-0.371 0.236-0.84-0.135-1.211zM4.004 8.287c0-2.366 1.917-4.283 4.282-4.283s4.474 2.107 4.474 4.474c0 2.365-1.918 4.283-4.283 4.283s-4.473-2.109-4.473-4.474z"});const x=({svgRef:e,title:t,...a})=>s.a.createElement("svg",S({width:20,height:20,viewBox:"0 0 20 20",ref:e},a),void 0===t?N:t?s.a.createElement("title",null,t):null,O),T=s.a.forwardRef((e,t)=>s.a.createElement(x,S({svgRef:t},e)));a.p;var I,A=a(86),j=a.n(A);function R(){const[e,t]=Object(n.useState)(""),[a,s]=Object(n.useState)(null),r=Object(n.useCallback)(e=>{s(null),e&&t("")},[]),c=Object(n.useCallback)(async e=>{r();const t=await(async e=>{try{const{data:t}=await m.get("",{params:{type:"series",s:e}});if(t&&t.Search)return t.Search}catch(t){console.error("error searching",t)}return[]})(e);s(t)},[r]),l=Object(n.useMemo)(()=>j()(c,700),[c]);Object(n.useEffect)(()=>{if(e&&e.length>=2)return l(e),()=>l.cancel();r()},[r,l,e]);const o=Object(n.useCallback)(e=>{t(e.target.value)},[]);return{bind:{value:e,onChange:o},setTerm:t,results:a}}function L(){const e=Object(n.useRef)(null),{selectShow:t}=w(),{bind:a,setTerm:r,results:c}=R(),[l,o]=Object(n.useState)(-1),[i,u]=Object(n.useState)(!1);Object(n.useEffect)(()=>{o(-1),u(!0)},[c]);const d=Object(n.useCallback)(()=>{c&&u(!0)},[c]),h=Object(n.useCallback)(e=>setTimeout(()=>u(!1),200),[]),p=Object(n.useCallback)(e=>{c&&c[e]&&(t(c[e].imdbID),r(""))},[c,t,r]);return Object(n.useEffect)(()=>{const e=e=>{switch(e.keyCode){case I.ESC:u(!1);break;case I.UP:c&&o(e=>Math.max(e-1,0));break;case I.DOWN:c&&(u(!0),o(e=>Math.min(e+1,c.length-1)));break;case I.ENTER:p(l)}};return document.addEventListener("keydown",e,!1),()=>document.removeEventListener("keydown",e,!1)},[l,c,p,t]),s.a.createElement(s.a.Fragment,null,s.a.createElement("header",null,s.a.createElement("h1",null,"Is it worth watching?")),s.a.createElement("div",{className:"search-container"},s.a.createElement("div",{className:"search"},s.a.createElement("div",{className:"search-bar__wrapper",onClick:()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.click()}},s.a.createElement("input",Object.assign({},a,{ref:e,className:"search-bar",placeholder:"Search shows",type:"text",autoFocus:!0,onFocus:d,onBlur:h})),s.a.createElement("div",{className:"search-bar__button"},s.a.createElement(T,null))),i&&s.a.createElement(_,{results:c,highlighted:l,select:p}))))}!function(e){e[e.UP=38]="UP",e[e.DOWN=40]="DOWN",e[e.ENTER=13]="ENTER",e[e.ESC=27]="ESC"}(I||(I={}));var D=a(1),k=a(87),C=a.n(k);const M=(e,t,a)=>{const n=(({items:e,svgWidth:t,dotSize:a,minSpacing:n,padding:s=0})=>Math.max(n,(t-2*s-e*a)/(e-1)))({items:a,svgWidth:e,dotSize:5,minSpacing:10,padding:20}),s=5+n,r=(e=>e.reduce((e,t,a)=>{const n=t.episodes[t.episodes.length-1].episode,s=e[a];return e.push(s+n),e},[0]))(t),c=r.map(e=>e*s+20),l=c.slice(0,c.length-1),o=c[r.length-1]-n+20;return{DOT_SPACING:n,SIZE:s,RANGES_NORMALIZED:c,RANGES_NORMALIZED_NO_LAST:l,TOTAL_WIDTH:o,VERTICAL_LINE_ADJUST:s/2}};function P(e,t,a){return{getx:t=>e(String(t.season))+(t.episode-1)*a,gety:e=>t(e.rating)}}const Z=["#9c27b0","#3f51b5","#2196f3","#009688","#8bc34a","#ffc107","#fb8c00","#f33d38"];function U(e,t){return(a,n)=>{const s=e[n+1],r=e[n];return(s-r)/2+r-t}}function W(e,t,a){return e.attr("class","x-axis-text").text(e=>"Season "+e.season).attr("x",U(t,a))}function G(e,t,a){return e.attr("class","x-axis-season-line").attr("y1",0).attr("y2",-a).attr("x1",e=>e-t).attr("x2",e=>e-t)}function J(e){return e.attr("class","dot").attr("r",5).attr("fill",e=>{return t=e.season,Z[t%Z.length];var t})}function z(e,t,a){return e.attr("cx",t).attr("cy",a)}function B(e,t,a){const n=e.append("g").attr("id","main"),s=n.append("path").attr("class","dot-line"),r=D.j();async function c(e,t,c){const{RANGES_NORMALIZED_NO_LAST:l,SIZE:o}=e;r.domain(t.map(e=>String(e.season))).range(l);const{getx:i,gety:u}=P(r,a,o),d=function(e,t,a){return D.g().x(e).y(t).curve(D.c)(a)}(i,u,c);s.attr("d",d);const h=s.node().getTotalLength();s.attr("stroke-dasharray",h+" "+h).attr("stroke-dashoffset",h).style("opacity",1).transition().duration(1200).ease(D.e).attr("stroke-dashoffset",0);const p=c.length;n.selectAll(".dot").data(c,e=>String(e.episode)).join(e=>e.append("circle").call(J),e=>e.call(J)).call(z,i,u).style("opacity",0).transition().duration(120).ease(D.e).delay((e,t)=>1200/p*(t+2)).style("opacity",1)}return{async generate(e,t,a){await c(e,t,a)},async update(t,a,r){const l=e.transition().duration(750),o=s.transition(l).style("opacity",0).end();n.selectAll(".dot").transition(l).style("opacity",0),await o,await c(t,a,r)},xScale:r}}var F=a(13);function V(e,t,a){const n=e.append("linearGradient").attr("id",t);return n.attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%"),n.selectAll("stop").data(a).enter().append("stop").attr("offset",e=>e[0]+"%").attr("stop-color",e=>e[1]).attr("stop-opacity",e=>e[2]),n}function $(e,t,a){const n=e.select("#content"),{displayRightFade:s,displayLeftFade:r}=function(e,t){const a=parseInt(e.attr("width"),10),n=e.append("defs");V(n,"left-fade-gradient",[[0,"white",1],[20,"white",1],[100,"white",0]]),V(n,"right-fade-gradient",[[0,"white",0],[80,"white",1],[100,"white",1]]);const s=e.append("rect").attr("class","fade-rect right").attr("x",-100).attr("y",0).attr("width",100).attr("height",t).style("fill","url(#left-fade-gradient)"),r=e.append("rect").attr("class","fade-rect right").attr("x",a).attr("y",0).attr("width",100).attr("height",t).style("fill","url(#right-fade-gradient)");return{displayLeftFade(e){e?s.transition().duration(500).attr("x",0):s.transition().duration(500).attr("x",-100)},displayRightFade(e){e?r.transition().duration(500).attr("x",a-100):r.transition().duration(500).attr("x",a)}}}(e,t),c=D.d(),l=D.l();function o(t){const{TOTAL_WIDTH:a}=t,o=parseInt(e.attr("width"),10),i=Math.abs(o-a)>15,u=i?a/o+1:1;l.scaleExtent([1,u]).translateExtent([[0,0],[i?a:o,0]]).on("zoom",(function(){const e=Math.min(Math.max(D.f.transform.x,o-a),0);n.attr("transform",`translate(${e})`),h(e)})),c.on("start",(function(){e.style("cursor","grabbing"),D.k(this).raise(),d=D.f.x})).on("drag",(function(){const t=-(d-D.f.x);d=D.f.x,l.translateBy(e,t,0)})).on("end",(function(){e.style("cursor","")})),e.call(c),e.call(l).on("wheel",()=>{D.f.preventDefault()}),h(0,!0);let d=0;function h(e,t){if(i||t){const t=Math.abs(e);s(t+o+50<a),r(t>50)}}}return o(a),{async reset(t){const a=(s=n,Object(F.b)(s.attr("transform")).translateX);var s;a&&await e.transition().duration(300).call(l.translateBy,-a,0).end(),c.on("start",null).on("drag",null).on("end",null),e.on("wheel",null),n.attr("transform","translate(0)"),o(t)}}}const H=e=>C()(e,"episodes");function Y(e,t,a){const n=H(t),{width:s,height:r}=e.getBoundingClientRect(),c=D.k(e).append("svg").attr("id","y-axis-svg").attr("width",1).attr("height",r),l=D.k(e).append("svg").attr("id","content-svg").attr("width",s).attr("height",r+50),o=M(s,t,n.length),i=l.append("g").attr("id","content"),u=i.append("g").attr("transform",`translate(0, ${r})`).attr("id","x-axis"),{yScale:d}=function(e,t,a){const n=D.i().domain([0,10]).range([t,0]);return e.call(D.a(n).tickSizeOuter(0)).selectAll("line").attr("x2",a).attr("class",(e,t)=>8===t?"y-tick-8":"y-tick").filter((e,t)=>0===t).remove(),e.selectAll("text").attr("class","y-axis-text"),e.select(".domain").attr("class","y-axis-line"),{yScale:n}}(c,r,s),h=function(e){const t=e.append("g").attr("id","x-divider-lines");return{generate(e,a){const{RANGES_NORMALIZED_NO_LAST:n,VERTICAL_LINE_ADJUST:s}=e;t.selectAll("line").data(n.filter((e,t)=>0!==t)).join("line").call(G,s,a)},update(e,a,n){const{RANGES_NORMALIZED_NO_LAST:s,VERTICAL_LINE_ADJUST:r}=e;t.selectAll("line").data(s.filter((e,t)=>0!==t)).join(e=>e.append("line").call(G,r,a).style("opacity",0),e=>e,e=>e.transition(n).style("opacity",0).remove()).transition(n).attr("x1",e=>e-r).attr("x2",e=>e-r).style("opacity",1)}}}(u),p=function(e){const t=e.append("line").attr("class","x-axis-line").attr("y1",0).attr("y2",0).attr("x1",0);return{generate(e){const{TOTAL_WIDTH:a}=e;t.attr("x2",a)},update(e,a){const{TOTAL_WIDTH:n}=e;t.transition(a).attr("x2",n)}}}(u),m=function(e){return{generate(t,a){const{RANGES_NORMALIZED:n,VERTICAL_LINE_ADJUST:s}=t;e.selectAll("text").data(a,e=>String(e.season)).join("text").call(W,n,s)},update(t,a,n,s){const{RANGES_NORMALIZED:r,VERTICAL_LINE_ADJUST:c}=t;e.selectAll("text").data(n,e=>String(e.season)).join(e=>e.append("text").call(W,r,c).style("opacity",0),e=>e,e=>e.transition(s).style("opacity",0).remove()).transition(s).attr("x",U(r,c)).style("opacity",1)}}}(u),f=B(i,0,d),g=function(e,t,a,n){const s=e.append("rect").attr("id","tooltip-overlay").attr("x",0).attr("y",0).attr("height",t);return{disable(){n(null),s.on("mousemove",null).on("mouseout",null)},update:function(e,t){const{TOTAL_WIDTH:r,RANGES_NORMALIZED:c,SIZE:l,VERTICAL_LINE_ADJUST:o}=e,{getx:i}=P(a,null,e.SIZE);s.attr("width",r);const u=D.b((t,a)=>i(t)-o+e.SIZE-a).left;s.on("mousemove",(function(e){const a=D.h(this)[0],s=u(t,a),r=t[s]||null;n(r)})).on("mouseout",()=>{n(null)})}}}(i,r,f.xScale,a);p.generate(o),m.generate(o,t),h.generate(o,r),f.generate(o,t,n),g.update(o,n);const E=$(l,r,o);return{async update(e){const t=H(e),a=M(s,e,t.length);await E.reset(a);const n=l.transition().duration(750);p.update(a,n),m.update(a,r,e,n),h.update(a,r,n),await f.update(a,e,t),g.update(a,t)}}}function q(){return(q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var X=s.a.createElement("title",null,"cycle"),K=s.a.createElement("path",{d:"M5.516 14.224c-2.262-2.432-2.222-6.244 0.128-8.611 0.962-0.969 2.164-1.547 3.414-1.736l-0.069-2.077c-1.755 0.213-3.452 0.996-4.797 2.351-3.149 3.17-3.187 8.289-0.123 11.531l-1.741 1.752 5.51 0.301-0.015-5.834-2.307 2.323zM12.163 2.265l0.015 5.834 2.307-2.322c2.262 2.434 2.222 6.246-0.128 8.611-0.961 0.969-2.164 1.547-3.414 1.736l0.069 2.076c1.755-0.213 3.452-0.996 4.798-2.35 3.148-3.172 3.186-8.291 0.122-11.531l1.741-1.754-5.51-0.3z"});const Q=({svgRef:e,title:t,...a})=>s.a.createElement("svg",q({width:20,height:20,viewBox:"0 0 20 20",ref:e},a),void 0===t?X:t?s.a.createElement("title",null,t):null,K),ee=s.a.forwardRef((e,t)=>s.a.createElement(Q,q({svgRef:t},e)));a.p;const te=e=>({href:"https://www.imdb.com/title/"+e,target:"_blank",rel:"noopener noreferrer"});function ae(){const{selectedShow:e}=w(),{info:t,seasons:a}=e;return s.a.createElement("div",{className:"info-panel"},s.a.createElement("div",{className:"info-panel__left"},s.a.createElement("a",Object.assign({},te(t.imdbID),{className:"info-panel__poster"}),v(t.Poster)?s.a.createElement("img",{src:t.Poster,alt:"poster"}):null),s.a.createElement("div",{className:"info-panel__rating"},t.imdbRating," ",s.a.createElement("span",null,"/ 10"))),s.a.createElement("div",{className:"info-panel__right"},s.a.createElement("a",Object.assign({},te(t.imdbID),{className:"info-panel__title"}),t.Title," ",s.a.createElement("span",null,"(",t.Year,")")),s.a.createElement("div",{className:"info-panel__genre"},t.Genre),s.a.createElement("div",{className:"info-panel__plot"},t.Plot),s.a.createElement("div",{className:"info-panel__seasons"},a.length," season",1===a.length?"":"s")))}function ne(){const{selectedShow:e,isLoading:t}=w(),a=Object(n.useRef)(null),r=Object(n.useRef)(null),[c,l]=Object(n.useState)(null);return Object(n.useEffect)(()=>{e&&r.current&&r.current.update(e.seasons)},[e]),e?s.a.createElement("div",{className:"chart__container"},s.a.createElement("div",{className:"chart__title"},s.a.createElement("h2",null,e.info.Title," ",s.a.createElement("span",null,"(",e.info.Year,")")),s.a.createElement("div",{className:"chart__episode"},c&&s.a.createElement(s.a.Fragment,null,s.a.createElement("span",{className:"chart__episode-number"},((e,t)=>{const a=("0"+t).slice(-2);return`S${("0"+e).slice(-2)}E${a}`})(c.season,c.episode),":"),s.a.createElement("span",{className:"chart__episode-name"},c.episodeTitle),s.a.createElement("span",{className:"chart__episode-rating"},c.rating," / 10")))),s.a.createElement("div",{className:"chart__wrapper "+(t?"loading":""),ref:function(t){t&&!r.current&&(console.log(e),r.current=Y(t,e.seasons,l)),a.current=t}},t&&s.a.createElement("span",{className:"chart__loading"},s.a.createElement(ee,null))),s.a.createElement(ae,null)):null}var se=function(){return s.a.createElement(b,null,s.a.createElement(L,null),s.a.createElement(ne,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(se,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()}).catch(e=>{console.error(e.message)})}},[[131,1,2]]]);
//# sourceMappingURL=main.3dd81d1e.chunk.js.map